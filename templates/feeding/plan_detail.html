{% extends "base.html" %}
{% block title %}Feeding Plan{% endblock %}

{% block content %}
<h1 class="mb-4">Feeding Plan</h1>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3">Plan</h5>

    <div class="row">
      <div class="col-md-6">
        <ul class="list-unstyled mb-0">
          <li class="mb-2">
            <strong>Aquarium:</strong>
            {{ plan.aquarium.name }} ({{ plan.aquarium.volume_liters }} L)
          </li>
          <li class="mb-2">
            <strong>Food:</strong>
            {{ plan.food.name }}
          </li>
          <li class="mb-2">
            <strong>Created:</strong>
            {{ plan.created_at }}
          </li>
        </ul>
      </div>

      <div class="col-md-6">
        <ul class="list-unstyled mb-0">
          <li class="mb-2">
            <strong>Daily amount:</strong>
            {{ daily_amount_display }} g/day
          </li>
          <li class="mb-2">
            <strong>Feedings per day:</strong>
            {{ plan.feedings_per_day }}
          </li>
          <li class="mb-2">
            <strong>Per feeding:</strong>
            {{ per_feeding_display }} g
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<div class="card shadow-sm mb-4">
  <div class="card-body">
    <h5 class="card-title mb-3">Water forecast</h5>

    {% if forecast %}
      <div class="row">
        <div class="col-md-4 mb-3">
          <div class="p-3 bg-light rounded border">
            <div class="text-muted small">Nitrate (ppm)</div>
            <div class="fs-4 fw-semibold">{{ nitrate_display }}</div>
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="p-3 bg-light rounded border">
            <div class="text-muted small">Phosphate (ppm)</div>
            <div class="fs-4 fw-semibold">{{ phosphate_display }}</div>
          </div>
        </div>

        <div class="col-md-4 mb-3">
          <div class="p-3 bg-light rounded border">
            <div class="text-muted small">Organic load index</div>
            <div class="fs-4 fw-semibold">{{ organic_display }}</div>
          </div>
        </div>
      </div>

      <div class="text-muted small">
        Forecast created: {{ forecast.created_at }}
      </div>
    {% else %}
      <div class="alert alert-warning mb-0">No forecast available.</div>
    {% endif %}
  </div>
</div>

{% if forecast %}
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Charts</h5>

      <div class="row">
        <div class="col-lg-6 mb-4">
          <div id="chart-nitrate"></div>
        </div>
        <div class="col-lg-6 mb-4">
          <div id="chart-phosphate"></div>
        </div>
        <div class="col-12">
          <div id="chart-organic"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h5 class="card-title mb-2">30â€‘day forecast</h5>
      <p class="text-muted small mb-3">
        Forecast assumes constant feeding, no water changes and no plants.
      </p>

      <div id="chart-forecast"></div>
    </div>
  </div>

  <script>
    const nitrateFig = JSON.parse('{{ charts.nitrate_json|escapejs }}');
    Plotly.newPlot('chart-nitrate', nitrateFig.data, nitrateFig.layout);

    const phosphateFig = JSON.parse('{{ charts.phosphate_json|escapejs }}');
    Plotly.newPlot('chart-phosphate', phosphateFig.data, phosphateFig.layout);

    const organicFig = JSON.parse('{{ charts.organic_json|escapejs }}');
    Plotly.newPlot('chart-organic', organicFig.data, organicFig.layout);

    const forecastFig = JSON.parse('{{ daily_forecast_chart|escapejs }}');
    Plotly.newPlot('chart-forecast', forecastFig.data, forecastFig.layout);
  </script>
{% endif %}

{% endblock %}