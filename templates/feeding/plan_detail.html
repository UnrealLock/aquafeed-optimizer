{% extends "base.html" %}
{% block title %}Feeding Plan{% endblock %}

{% block content %}
  <h1>Feeding Plan</h1>

  <h2>Plan</h2>
  <ul>
    <li>
      <strong>Aquarium:</strong>
      {{ plan.aquarium.name }} ({{ plan.aquarium.volume_liters }} L)
    </li>

    <li>
      <strong>Food:</strong>
      {{ plan.food.name }}
    </li>

    <li>
      <strong>Daily amount:</strong>
      {{ daily_amount_display }} g / day
    </li>

    <li>
      <strong>Feedings per day:</strong>
      {{ plan.feedings_per_day }}
    </li>

    <li>
      <strong>Per feeding:</strong>
      {{ per_feeding_display }} g
    </li>

    <li>
      <strong>Created:</strong>
      {{ plan.created_at }}
    </li>
  </ul>

  <h2>Water forecast</h2>

  {% if forecast %}
    <ul>
      <li>
        <strong>Nitrate (ppm):</strong>
        {{ nitrate_display }}
      </li>

      <li>
        <strong>Phosphate (ppm):</strong>
        {{ phosphate_display }}
      </li>

      <li>
        <strong>Organic load index:</strong>
        {{ organic_display }}
      </li>

      <li>
        <strong>Forecast created:</strong>
        {{ forecast.created_at }}
      </li>
    </ul>

    <h2>Charts</h2>

    <div id="chart-nitrate"></div>
    <div id="chart-phosphate"></div>
    <div id="chart-organic"></div>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script>
      const nitrateFig = JSON.parse('{{ charts.nitrate_json|escapejs }}');
      Plotly.newPlot('chart-nitrate', nitrateFig.data, nitrateFig.layout);

      const phosphateFig = JSON.parse('{{ charts.phosphate_json|escapejs }}');
      Plotly.newPlot('chart-phosphate', phosphateFig.data, phosphateFig.layout);

      const organicFig = JSON.parse('{{ charts.organic_json|escapejs }}');
      Plotly.newPlot('chart-organic', organicFig.data, organicFig.layout);
    </script>

  {% else %}
    <p>No forecast available.</p>
  {% endif %}
{% endblock %}