# ТЕХНИЧЕСКОЕ ЗАДАНИЕ
# Aqua Feed Optimizer
## Веб-сервис для расчёта кормления и прогноза качества воды в аквариумах

---

## 1. ЦЕЛЬ ПРОЕКТА

Разработка веб‑сервиса для аквариумистов, который:

- **Рассчитывает оптимальный рацион кормления рыб** (суточная норма и порции)
- **Анализирует пищевую ценность кормов**
- **Прогнозирует влияние кормления на качество воды** (нитраты NO₃, фосфаты PO₄, индекс органической нагрузки)
- **Учитывает параметры аквариума**, бионагрузку, растения и плановые подмены воды

**Основная цель сервиса** — помочь избежать перекорма, ухудшения качества воды и рисков для здоровья рыб.

---

## 2. ЦЕЛЕВАЯ АУДИТОРИЯ И РОЛИ ПОЛЬЗОВАТЕЛЕЙ

### **Гость**
- Просмотр справочной информации по видам рыб и кормам
- Ознакомление с функционалом (без доступа к личным данным и созданию аквариумов)

### **Авторизованный пользователь**
- Создание и управление профилями своих аквариумов
- Добавление рыб в аквариум (вид и количество)
- Добавление/выбор кормов (из справочника)
- Создание планов кормления и просмотр результатов расчёта
- Просмотр прогнозов качества воды и графиков (NO₃, PO₄, органика)
- Управление плановыми подменами воды
- Добавление растений в аквариум (влияние на прогноз воды)
- Просмотр списка созданных планов кормления и возможность их удаления

### **Администратор**
- Управление справочниками видов рыб и кормов
- Модерация данных (корректировка параметров, удаление ошибочных записей)
- Просмотр расчётов пользователей (при необходимости)

---

## 3. МОДЕЛИ ДАННЫХ (СУЩНОСТИ)

### **Aquarium** (Профиль аквариума пользователя)
- `user` (ForeignKey → User)
- `name`
- `volume_liters`
- `temperature`
- `filtration_type`
- `created_at`

### **FishSpecies** (Справочник видов рыб)
- `name`
- `average_weight_grams`
- `feeding_coefficient`
- `waste_factor`

### **AquariumFish** (Рыбы в конкретном аквариуме)
- `aquarium` (ForeignKey → Aquarium)
- `species` (ForeignKey → FishSpecies)
- `count`

### **Food** (Справочник кормов)
- `name`
- `protein_percent`
- `fat_percent`
- `fiber_percent`
- `ash_percent`
- `pollution_index`

### **Plant** (Справочник растений)
- `name`
- `nitrate_absorption` (скорость поглощения NO₃, ppm/день)
- `phosphate_absorption` (скорость поглощения PO₄, ppm/день)

### **AquariumPlant** (Растения в конкретном аквариуме)
- `aquarium` (ForeignKey → Aquarium)
- `plant` (ForeignKey → Plant)
- `quantity`

### **WaterChange** (Плановые подмены воды)
- `aquarium` (ForeignKey → Aquarium)
- `day_interval` (например, каждые N дней)
- `percent` (процент подмены)

### **FeedingPlan** (План кормления / результат расчёта)
- `aquarium` (ForeignKey → Aquarium)
- `food` (ForeignKey → Food)
- `daily_amount_grams`
- `feedings_per_day`
- `created_at`

### **WaterQualityForecast** (Прогноз качества воды по плану кормления)
- `feeding_plan` (ForeignKey → FeedingPlan)
- `nitrate_ppm`
- `phosphate_ppm`
- `organic_load_index`
- `created_at`

---

## 4. ОСНОВНЫЕ ПОЛЬЗОВАТЕЛЬСКИЕ СЦЕНАРИИ (USER STORIES)

1. **Создание аквариума**
   - Пользователь создаёт аквариум и задаёт параметры (объём, температура, фильтрация)

2. **Добавление рыб**
   - Пользователь добавляет рыбу в аквариум (вид и количество)

3. **Выбор корма**
   - Пользователь выбирает корм из справочника

4. **Расчёт кормления**
   - Система рассчитывает суточную норму кормления и размер порции за одно кормление

5. **Добавление растений**
   - Пользователь добавляет растения в аквариум (количество каждого вида)

6. **Настройка подмен воды**
   - Пользователь настраивает плановые подмены воды (например, каждые 7 дней 25%)

7. **Прогноз качества воды**
   - Система строит прогноз на 30 дней:
     - NO₃ и PO₄ с учётом кормления, растений и подмен
     - Индекс органической нагрузки с учётом фильтрации, бионагрузки и ежедневного самоочищения

8. **Просмотр результатов**
   - Пользователь видит результаты:
     - Карточки (NO₃, PO₄, органика)
     - Гейджи и графики
     - Оценку по максимальным значениям за период

9. **Управление планами кормления**
   - Пользователь имеет доступ к своим ранее созданным планам кормления:
     - Список «Мои планы кормления»
     - Возможность открыть план
     - Возможность удалить план (чтобы база не засорялась)

---

## 5. РАСЧЁТНАЯ ЛОГИКА И ДОПУЩЕНИЯ

### **Расчёт кормления**
- Суточная норма зависит от суммарной массы рыб (через средний вес вида), коэффициента кормления и выбранной частоты кормления

### **Прогноз NO₃ и PO₄**
- Ежедневное увеличение зависит от количества корма и `pollution_index`
- Ежедневное уменьшение учитывает суммарное поглощение растениями (`absorption * quantity`)
- Подмены воды уменьшают концентрации на заданный процент

### **Индекс органической нагрузки**
- Ежедневная органическая нагрузка зависит от количества корма и "грязности" рыб (`waste_factor`)
- Учтена фильтрация
- Введена модель ежедневного самоочищения (органика не растёт бесконечно, а выходит на плато; подмены дают характерную "пилу")

---

## 6. ВНЕШНИЕ ИНТЕГРАЦИИ И АНАЛИТИКА

### **Планировавшиеся интеграции**
- **Open Food Facts API** — автоматическое получение состава кормов (белки/жиры/клетчатка и т.п.)

### **Фактически реализовано**
- Визуализация прогнозов (Plotly) в веб‑интерфейсе
- Расчёты выполняются внутри приложения на основе данных из базы

### **Что не реализовано (и почему)**
Интеграция с **Open Food Facts API** не реализована, так как:

1. **API ориентирован на продукты питания для людей** и не всегда содержит релевантные данные по специализированным кормам для рыб
2. **Требовалась отдельная логика сопоставления названий и нормализации данных** (не укладывалось в сроки проекта)
3. **Приоритет был отдан стабильной локальной модели справочников и прогнозов** (основной функционал проекта)

---

## 7. ИЗМЕНЕНИЯ В ХОДЕ РЕАЛИЗАЦИИ

### **Добавлены растения и их влияние на воду**
- Вынесены в отдельный справочник `Plant`
- Добавлена связующая модель `AquariumPlant` (многие‑ко‑многим с количеством)

### **Добавлены плановые подмены воды**
- Модель `WaterChange`
- Учёт подмен в прогнозе на 30 дней

### **Улучшена модель органической нагрузки**
- Добавлено ежедневное самоочищение (органика перестала накапливаться бесконечно)

### **Исправлена согласованность отображения прогнозов**
- Показатели на карточках/гейджах синхронизированы с максимумами 30‑дневной симуляции
